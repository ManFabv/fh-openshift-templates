{
  "apiVersion": "v1",
  "kind": "Template",
  "metadata": {
    "name": "nagios-template"
  },
  "objects": [
    {
      "apiVersion": "v1",
      "kind": "Service",
      "metadata": {
        "name": "nagios"
      },
      "spec": {
        "ports": [
          {
            "port": 8080
          }
        ],
        "selector": {
          "name": "nagios"
        }
      }
    },
    {
      "apiVersion": "v1",
      "kind": "Route",
      "metadata": {
        "name": "nagios"
      },
      "spec": {
        "host": "${NAGIOS_HOST}",
        "tls": {
          "insecureEdgeTerminationPolicy": "Allow",
          "termination": "edge"
        },
        "to": {
          "kind": "Service",
          "name": "nagios"
        }
      }
    },
    {
      "apiVersion": "v1",
      "kind": "DeploymentConfig",
      "metadata": {
        "name": "nagios"
      },
      "spec": {
        "replicas": 1,
        "selector": {
          "name": "nagios"
        },
        "strategy": {
          "type": "Recreate"
        },
        "template": {
          "metadata": {
            "labels": {
              "name": "nagios"
            }
          },
          "spec": {
            "containers": [
              {
                "env": [
                  {
                    "name": "SMTP_SERVER",
                    "value": "${SMTP_SERVER}"
                  },
                  {
                    "name": "SMTP_USERNAME",
                    "value": "${SMTP_USERNAME}"
                  },
                  {
                    "name": "SMTP_PASSWORD",
                    "value": "${SMTP_PASSWORD}"
                  },
                  {
                    "name": "SMTP_TLS",
                    "value": "${SMTP_TLS}"
                  },
                  {
                    "name": "SMTP_FROM_ADDRESS",
                    "value": "${SMTP_FROM_ADDRESS}"
                  },
                  {
                    "name": "ADMIN_EMAIL",
                    "value": "${ADMIN_EMAIL}"
                  },
                  {
                    "name": "NAGIOS_USER",
                    "value": "${NAGIOS_USER}"
                  },
                  {
                    "name": "NAGIOS_PASSWORD",
                    "value": "${NAGIOS_PASSWORD}"
                  },
                  {
                    "name": "RHMAP_ROUTER_DNS",
                    "value": "${RHMAP_ROUTER_DNS}"
                  }
                ],
                "image": "${NAGIOS_IMAGE_NAME}:${NAGIOS_IMAGE_VERSION}",
                "name": "nagios",
                "ports": [
                  {
                    "containerPort": 8080
                  }
                ]
              }
            ]
          }
        },
        "triggers": [
          {
            "type": "ConfigChange"
          }
        ]
      }
    }
  ],
  "parameters": [
    {
      "description": "Nagios hostname to expose a route as",
      "name": "NAGIOS_HOST",
      "required": true
    },
    {
      "description": "SMTP server address to use for sending alert emails e.g. 1.2.3.4:25",
      "name": "SMTP_SERVER",
      "value": "localhost"
    },
    {
      "description": "SMTP username",
      "name": "SMTP_USERNAME",
      "required": true
    },
    {
      "description": "SMTP password",
      "name": "SMTP_PASSWORD",
      "required": true
    },
    {
      "description": "Use TLS for message delivery (auto|yes|no)",
      "name": "SMTP_TLS",
      "value": "auto"
    },
    {
      "description": "From email address for alerts",
      "name": "SMTP_FROM_ADDRESS",
      "value": "admin@example.com"
    },
    {
      "description": "To email address for alerts",
      "name": "ADMIN_EMAIL",
      "value": "root@localhost"
    },
    {
      "description": "Nagios admin username",
      "name": "NAGIOS_USER",
      "value": "nagiosadmin"
    },
    {
      "description": "Nagios admin user password",
      "from": "[a-zA-Z0-9]{10}",
      "generate": "expression",
      "name": "NAGIOS_PASSWORD"
    },
    {
      "description": "Host or Service name for RHMAP",
      "name": "RHMAP_ROUTER_DNS",
      "value": "fh-rhmap-service"
    },
    {
      "description": "The name of the Nagios Docker image",
      "name": "NAGIOS_IMAGE_NAME",
      "value": "docker.io/rhmap/nagios4"
    },
    {
      "description": "The version of the Nagios Docker image",
      "name": "NAGIOS_IMAGE_VERSION",
      "value": "4.0.8-29"
    }
  ]
}
